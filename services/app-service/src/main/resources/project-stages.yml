swarm:
  http:
    port: 8080
  contex:
    path: "/"
  logging:
    pattern-formatters:
      DEFAULT_LOG_PATTERN:
        pattern: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p (%t) [%C{2}] trace.id=%X{trace.id} | trace.group=%X{trace.group} - %m%n"
    console-handlers:
      CONSOLE:
        named-formatter: DEFAULT_LOG_PATTERN
---
# Necessary because config set via 'swarm.jaeger.*', breaks jaeger integration
JAEGER_SERVICE_NAME: "${project.build.finalName}"
JAEGER_AGENT_HOST: "localhost"
JAEGER_AGENT_PORT: "6831"
JAEGER_REPORTER_LOG_SPANS: "true"
JAEGER_REPORTER_FLUSH_INTERVAL: "1000"
JAEGER_SAMPLER_TYPE: "const"
JAEGER_SAMPLER_PARAM: "1"

project:
  stage: dev
swarm:
  http:
    port: 8081
  management:
    http:
      port: 9991
  logging:
    root-logger:
      level: INFO
      handlers:
        - CONSOLE
    loggers:
      org.keycloak:
        level: INFO
        handlers:
          - CONSOLE
      com.google:
        level: INFO
        handlers:
          - CONSOLE
  microprofile:
    config:
      config-sources:
        app.secrets:
          properties:
            service.db.base-url: http://localhost:8082/rest-api
---
project:
  stage: test
swarm:
  logging: INFO
  microprofile:
    config:
      config-sources:
        APP:
          properties:
            service.db.base-url: http://localhost:8082
---
# Necessary because config set via 'swarm.jaeger.*', breaks jaeger integration
JAEGER_SERVICE_NAME: "${project.build.finalName}"
JAEGER_AGENT_HOST: "${env.JAEGER_HOST}"
JAEGER_AGENT_PORT: "${env.JAEGER_PORT}"
JAEGER_REPORTER_LOG_SPANS: "true"
JAEGER_REPORTER_FLUSH_INTERVAL: "1000"
JAEGER_SAMPLER_TYPE: "const"
JAEGER_SAMPLER_PARAM: "1"

project:
  stage: openshift
swarm:
  keycloak:
    json:
      path: ${oc.secret-service-app-keycloak.dir}/keycloak.json
  deployment:
    ${project.build.finalName}.war:
      web:
        login-config:
          auth-method: KEYCLOAK
        security-constraints:
          - url-pattern: /rest-api/report/*
            roles: [client]
  logging:
    custom-handlers:
      SYSLOGGER:
        named-formatter: DEFAULT_LOG_PATTERN
        attribute-class: org.jboss.logmanager.handlers.SyslogHandler
        module: org.jboss.logmanager
        properties:
          serverHostname: graylog
          hostname: ${project.build.finalName}
          port: 10514
          protocol: UDP
    root-logger:
      level: WARN
      handlers:
        - CONSOLE
        - SYSLOGGER
    loggers:
      com.gepardec:
        level: INFO
        handlers:
          - CONSOLE
          - SYSLOGGER
      org.keycloak:
        level: TRACE
        handlers:
          - CONSOLE
          - SYSLOGGER
  microprofile:
    config:
      config-sources:
        app.secrets:
          dir: ${oc.secret-service-app.dir}
